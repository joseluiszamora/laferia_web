generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  directUrl  = env("DIRECT_URL")
  extensions = [uuid_ossp(map: "uuid-ossp", schema: "extensions")]
}

model Category {
  category_id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  parent_category_id String?  @db.Uuid
  name               String   @unique
  slug               String   @unique
  description        String?
  icon               String?
  color              String?
  image_url          String?
  created_at         DateTime @default(now())
  Tienda             Tienda[]

  @@index([name], map: "idx_category_name")
  @@index([parent_category_id], map: "idx_category_parent_id")
  @@index([slug], map: "idx_category_slug")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Comentario {
  comentario_id  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tienda_id      String    @db.Uuid
  nombre_usuario String    @db.VarChar(255)
  avatar_url     String?
  comentario     String
  calificacion   Decimal   @db.Decimal(2, 1)
  fecha_creacion DateTime? @default(now()) @db.Timestamptz(6)
  verificado     Boolean?  @default(false)
  imagenes       String[]  @default([])
  activo         Boolean?  @default(true)
  Tienda         Tienda    @relation(fields: [tienda_id], references: [tienda_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([calificacion], map: "idx_comentario_calificacion")
  @@index([fecha_creacion], map: "idx_comentario_fecha")
  @@index([tienda_id], map: "idx_comentario_tienda")
  @@index([verificado], map: "idx_comentario_verificado")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Tienda {
  tienda_id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nombre                String       @db.VarChar(255)
  nombre_propietario    String       @db.VarChar(255)
  latitud               Float
  longitud              Float
  categoria_id          String       @db.Uuid
  productos             String[]     @default([])
  contacto              Json?
  direccion             String?
  dias_atencion         String[]     @default(["Jueves", "Domingo"])
  horario_atencion      String?      @default("08:00 - 18:00") @db.VarChar(50)
  horario               String?      @db.VarChar(50)
  calificacion_promedio Decimal?     @default(0.00) @db.Decimal(3, 2)
  activa                Boolean?     @default(true)
  fecha_registro        DateTime?    @default(now()) @db.Timestamptz(6)
  fecha_actualizacion   DateTime?    @default(now()) @db.Timestamptz(6)
  Comentario            Comentario[]
  Category              Category     @relation(fields: [categoria_id], references: [category_id], onUpdate: NoAction)

  @@index([activa], map: "idx_tienda_activa")
  @@index([calificacion_promedio], map: "idx_tienda_calificacion")
  @@index([categoria_id], map: "idx_tienda_categoria")
  @@index([nombre], map: "idx_tienda_nombre")
  @@index([nombre_propietario], map: "idx_tienda_propietario")
  @@index([latitud, longitud], map: "idx_tienda_ubicacion")
}
